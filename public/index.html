<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WCAG 2.1 Level AA Accessibility Scanner - Comprehensive web accessibility testing tool">
    <title>WCAG Accessibility Scanner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>üîç WCAG Accessibility Scanner</h1>
            <p class="subtitle">Comprehensive WCAG 2.1 Level AA Compliance Testing</p>
        </header>

        <!-- Scan Form Section -->
        <section class="scan-section">
            <div class="form-container">
                <label for="url-input">Enter Website URL:</label>
                <div class="input-group">
                    <input 
                        type="url" 
                        id="url-input" 
                        placeholder="https://example.com" 
                        required
                        aria-label="Website URL to scan"
                    >
                    <button type="button" id="scan-btn" onclick="startScan()">
                        <span id="btn-text">Scan Website</span>
                        <span id="btn-spinner" class="spinner" style="display: none;"></span>
                    </button>
                </div>
                <p class="help-text">Enter a complete URL including http:// or https://</p>
            </div>
        </section>

        <!-- Loading Section -->
        <section id="loading-section" class="loading-section" style="display: none;">
            <div class="loading-content">
                <div class="loader"></div>
                <p>Scanning website for accessibility issues...</p>
                <p class="loading-subtext">This may take 10-30 seconds</p>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="results-section" style="display: none;">
            <!-- Summary Cards -->
            <div class="summary-container">
                <h2>Scan Results</h2>
                <div id="scan-info" class="scan-info"></div>

                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="card-icon">üìä</div>
                        <div class="card-content">
                            <h3>Total Tests</h3>
                            <p id="total-tests" class="stat-number">0</p>
                        </div>
                    </div>
                    <div class="summary-card success">
                        <div class="card-icon">‚úÖ</div>
                        <div class="card-content">
                            <h3>Passed</h3>
                            <p id="total-passes" class="stat-number">0</p>
                        </div>
                    </div>
                    <div class="summary-card error">
                        <div class="card-icon">‚ö†Ô∏è</div>
                        <div class="card-content">
                            <h3>Issues Found</h3>
                            <p id="total-issues" class="stat-number">0</p>
                        </div>
                    </div>
                </div>

                <!-- Severity Breakdown -->
                <div id="severity-breakdown" class="severity-breakdown"></div>
            </div>

            <!-- Category Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <button type="button" class="tab active" onclick="showTab('all', this)">All Issues</button>
                    <button type="button" class="tab" onclick="showTab('colorContrast', this)">Color Contrast</button>
                    <button type="button" class="tab" onclick="showTab('images', this)">Images</button>
                    <button type="button" class="tab" onclick="showTab('keyboard', this)">Keyboard</button>
                    <button type="button" class="tab" onclick="showTab('semanticHTML', this)">Semantic HTML</button>
                    <button type="button" class="tab" onclick="showTab('other', this)">Other</button>
                </div>
            </div>

            <!-- Issues Container -->
            <div id="issues-container" class="issues-container"></div>

            <!-- Download Report Button -->
            <div class="action-buttons">
                <button type="button" onclick="downloadReport()" class="download-btn">üì• Download HTML Report</button>
                <button type="button" onclick="resetScanner()" class="reset-btn">üîÑ Scan Another Site</button>
            </div>
        </section>

        <!-- Error Section -->
        <section id="error-section" class="error-section" style="display: none;">
            <div class="error-content">
                <div class="error-icon">‚ùå</div>
                <h2>Scan Failed</h2>
                <p id="error-message"></p>
                <button type="button" onclick="resetScanner()" class="retry-btn">Try Again</button>
            </div>
        </section>
    </div>

    <footer>
        <p>Powered by <strong>axe-core</strong> | WCAG 2.1 Level AA Standards</p>
    </footer>

    <script>
        let scanResults = null;

        async function startScan() {
            const urlInput = document.getElementById('url-input');
            const url = urlInput.value.trim();

            if (!url) {
                alert('Please enter a URL');
                return;
            }

            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                alert('Please enter a valid URL (including http:// or https://)');
                return;
            }

            // Show loading state
            showSection('loading-section');
            disableScanButton(true);

            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Scan failed');
                }

                scanResults = await response.json();
                displayResults(scanResults);
                showSection('results-section');

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error-message').textContent = error.message;
                showSection('error-section');
            } finally {
                disableScanButton(false);
            }
        }

        function showSection(sectionId) {
            const sections = ['loading-section', 'results-section', 'error-section'];
            sections.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

        function disableScanButton(disabled) {
            const btn = document.getElementById('scan-btn');
            const btnText = document.getElementById('btn-text');
            const btnSpinner = document.getElementById('btn-spinner');
            
            btn.disabled = disabled;
            btnText.style.display = disabled ? 'none' : 'inline';
            btnSpinner.style.display = disabled ? 'inline-block' : 'none';
        }

        function displayResults(results) {
            // Display scan info
            const scanInfo = document.getElementById('scan-info');
            scanInfo.innerHTML = `
                <p><strong>URL:</strong> <a href="${results.url}" target="_blank">${results.url}</a></p>
                <p><strong>Scan Time:</strong> ${new Date(results.timestamp).toLocaleString()}</p>
            `;

            // Display summary statistics
            document.getElementById('total-tests').textContent = results.summary.totalTests;
            document.getElementById('total-passes').textContent = results.summary.totalPasses;
            document.getElementById('total-issues').textContent = results.summary.totalIssues;

            // Display severity breakdown
            const severityBreakdown = document.getElementById('severity-breakdown');
            severityBreakdown.innerHTML = `
                <h3>Issues by Severity</h3>
                <div class="severity-bars">
                    <div class="severity-bar critical">
                        <span class="severity-label">Critical</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${getPercentage(results.summary.issuesBySeverity.critical, results.summary.totalIssues)}%"></div>
                        </div>
                        <span class="severity-count">${results.summary.issuesBySeverity.critical}</span>
                    </div>
                    <div class="severity-bar serious">
                        <span class="severity-label">Serious</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${getPercentage(results.summary.issuesBySeverity.serious, results.summary.totalIssues)}%"></div>
                        </div>
                        <span class="severity-count">${results.summary.issuesBySeverity.serious}</span>
                    </div>
                    <div class="severity-bar moderate">
                        <span class="severity-label">Moderate</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${getPercentage(results.summary.issuesBySeverity.moderate, results.summary.totalIssues)}%"></div>
                        </div>
                        <span class="severity-count">${results.summary.issuesBySeverity.moderate}</span>
                    </div>
                    <div class="severity-bar minor">
                        <span class="severity-label">Minor</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${getPercentage(results.summary.issuesBySeverity.minor, results.summary.totalIssues)}%"></div>
                        </div>
                        <span class="severity-count">${results.summary.issuesBySeverity.minor}</span>
                    </div>
                </div>
            `;

            // Display all issues initially
            showTab('all');
        }

       function showTab(category, clickedTab) {
    // Update active tab
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active'));
    if (clickedTab) {
        clickedTab.classList.add('active');
    }

            // Display issues for selected category
            const issuesContainer = document.getElementById('issues-container');
            issuesContainer.innerHTML = '';

            let issuesToDisplay = [];
            
            if (category === 'all') {
                // Combine all severity levels
                Object.keys(scanResults.violations).forEach(severity => {
                    issuesToDisplay = issuesToDisplay.concat(scanResults.violations[severity]);
                });
            } else {
                issuesToDisplay = scanResults.categories[category] || [];
            }

            if (issuesToDisplay.length === 0) {
                issuesContainer.innerHTML = `
                    <div class="no-issues">
                        <p>‚úÖ No issues found in this category!</p>
                    </div>
                `;
                return;
            }

            // Display issues
            issuesToDisplay.forEach(violation => {
                violation.nodes.forEach((node, index) => {
                    const issueCard = createIssueCard(violation, node, index);
                    issuesContainer.appendChild(issueCard);
                });
            });
        }

        function createIssueCard(violation, node, index) {
            const card = document.createElement('div');
            card.className = `issue-card ${violation.impact}`;
            
            card.innerHTML = `
                <div class="issue-header">
                    <div class="issue-title">
                        <span class="impact-badge ${violation.impact}">${violation.impact.toUpperCase()}</span>
                        <h3>${violation.help}</h3>
                    </div>
                    <button type="button" class="toggle-btn" onclick="toggleDetails(this)">‚ñº</button>
                </div>
                
                <p class="issue-description">${violation.description}</p>
                
                <div class="issue-details" style="display: none;">
                    <div class="detail-section">
                        <h4>üéØ WCAG Criteria</h4>
                        <div class="wcag-tags">
                            ${node.wcagCriteria.map(criteria => `<span class="tag">${criteria}</span>`).join('')}
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4>üìç Element Location</h4>
                        <p><strong>CSS Selector:</strong></p>
                        <code class="selector">${node.target.join(', ')}</code>
                    </div>

                    <div class="detail-section">
                        <h4>üíª HTML Snippet</h4>
                        <pre><code>${escapeHtml(node.html)}</code></pre>
                    </div>

                    <div class="detail-section">
                        <h4>‚ùå Issue</h4>
                        <p>${node.remediation.issue}</p>
                    </div>

                    <div class="detail-section">
                        <h4>‚úÖ How to Fix</h4>
                        <ol class="remediation-steps">
                            ${node.remediation.steps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>

                    <div class="detail-section">
                        <h4>üìö Learn More</h4>
                        <a href="${violation.helpUrl}" target="_blank" class="help-link">View Complete Documentation ‚Üí</a>
                    </div>
                </div>
            `;

            return card;
        }

        function toggleDetails(button) {
            const details = button.closest('.issue-card').querySelector('.issue-details');
            const isVisible = details.style.display === 'block';
            details.style.display = isVisible ? 'none' : 'block';
            button.textContent = isVisible ? '‚ñº' : '‚ñ≤';
        }

        function getPercentage(value, total) {
            return total === 0 ? 0 : (value / total * 100).toFixed(1);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function downloadReport() {
            const reportHtml = generateHTMLReport(scanResults);
            const blob = new Blob([reportHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `accessibility-report-${new Date().getTime()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generateHTMLReport(results) {
            let allIssues = [];
            Object.keys(results.violations).forEach(severity => {
                allIssues = allIssues.concat(results.violations[severity]);
            });

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCAG Accessibility Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; margin-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h3 { color: #2c3e50; margin-top: 20px; margin-bottom: 10px; }
        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .summary-card { padding: 20px; border-radius: 8px; background: #ecf0f1; }
        .summary-card h3 { margin: 0; font-size: 14px; color: #7f8c8d; }
        .summary-card .number { font-size: 36px; font-weight: bold; color: #2c3e50; margin-top: 10px; }
        .issue { margin: 20px 0; padding: 20px; border-left: 4px solid #e74c3c; background: #fff5f5; border-radius: 4px; }
        .issue.critical { border-left-color: #c0392b; background: #ffe6e6; }
        .issue.serious { border-left-color: #e74c3c; background: #fff0f0; }
        .issue.moderate { border-left-color: #f39c12; background: #fff8e6; }
        .issue.minor { border-left-color: #3498db; background: #e8f4f8; }
        .impact-badge { display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-bottom: 10px; color: white; }
        .impact-badge.critical { background: #c0392b; }
        .impact-badge.serious { background: #e74c3c; }
        .impact-badge.moderate { background: #f39c12; }
        .impact-badge.minor { background: #3498db; }
        code { background: #f8f9fa; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 14px; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; margin: 10px 0; }
        ol { padding-left: 20px; }
        ol li { margin: 8px 0; }
        .info-box { background: #e8f4f8; padding: 15px; border-radius: 4px; margin: 20px 0; border-left: 4px solid #3498db; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç WCAG Accessibility Report</h1>
        <div class="info-box">
            <p><strong>URL:</strong> ${results.url}</p>
            <p><strong>Scan Date:</strong> ${new Date(results.timestamp).toLocaleString()}</p>
            <p><strong>Standards:</strong> WCAG 2.1 Level AA</p>
        </div>

        <h2>Summary</h2>
        <div class="summary">
            <div class="summary-card">
                <h3>Total Tests</h3>
                <div class="number">${results.summary.totalTests}</div>
            </div>
            <div class="summary-card">
                <h3>Passed</h3>
                <div class="number" style="color: #27ae60;">${results.summary.totalPasses}</div>
            </div>
            <div class="summary-card">
                <h3>Issues Found</h3>
                <div class="number" style="color: #e74c3c;">${results.summary.totalIssues}</div>
            </div>
        </div>

        <h2>Issues by Severity</h2>
        <div class="summary">
            <div class="summary-card">
                <h3>Critical</h3>
                <div class="number" style="color: #c0392b;">${results.summary.issuesBySeverity.critical}</div>
            </div>
            <div class="summary-card">
                <h3>Serious</h3>
                <div class="number" style="color: #e74c3c;">${results.summary.issuesBySeverity.serious}</div>
            </div>
            <div class="summary-card">
                <h3>Moderate</h3>
                <div class="number" style="color: #f39c12;">${results.summary.issuesBySeverity.moderate}</div>
            </div>
            <div class="summary-card">
                <h3>Minor</h3>
                <div class="number" style="color: #3498db;">${results.summary.issuesBySeverity.minor}</div>
            </div>
        </div>

        <h2>Detailed Issues</h2>
        ${allIssues.map((violation, idx) => 
            violation.nodes.map((node, nodeIdx) => `
                <div class="issue ${violation.impact}">
                    <span class="impact-badge ${violation.impact}">${violation.impact.toUpperCase()}</span>
                    <h3>${violation.help}</h3>
                    <p>${violation.description}</p>
                    
                    <h4>WCAG Criteria:</h4>
                    <p>${node.wcagCriteria.join(', ')}</p>
                    
                    <h4>Element Location:</h4>
                    <p><strong>CSS Selector:</strong> <code>${node.target.join(', ')}</code></p>
                    
                    <h4>HTML Snippet:</h4>
                    <pre><code>${escapeHtml(node.html)}</code></pre>
                    
                    <h4>Issue:</h4>
                    <p>${node.remediation.issue}</p>
                    
                    <h4>How to Fix:</h4>
                    <ol>
                        ${node.remediation.steps.map(step => `<li>${step}</li>`).join('')}
                    </ol>
                    
                    <p><strong>Learn More:</strong> <a href="${violation.helpUrl}" target="_blank">${violation.helpUrl}</a></p>
                </div>
            `).join('')
        ).join('')}

        <h2>Tests Passed</h2>
        <p>The following ${results.passes.length} test categories passed successfully:</p>
        <ul>
            ${results.passes.map(pass => `<li><strong>${pass.help}</strong> - ${pass.nodeCount} elements checked</li>`).join('')}
        </ul>
    </div>
</body>
</html>`;
        }

        function resetScanner() {
            document.getElementById('url-input').value = '';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('error-section').style.display = 'none';
            scanResults = null;
        }

        // Allow Enter key to trigger scan
        document.getElementById('url-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startScan();
            }
        });
    </script>
</body>
</html>
